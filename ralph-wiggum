#!/usr/bin/env bash
# ralph-wiggum: "I'm helping!"
set -e

# Wipe progress.txt at start
> progress.txt

echo "=== Starting ralph-wiggum ==="

MAX_ITERATIONS=1

for ((i=1; i<=MAX_ITERATIONS; i++)); do
  echo "=== Iteration $i of $MAX_ITERATIONS ==="

  result=$(claude --dangerously-skip-permissions -p "$(cat prompt.md)" 2>&1 | tee /dev/stderr)

  if [[ "$result" == *"<promise>COMPLETE</promise>"* ]]; then
    echo ""
    echo "=== PRD complete! ==="
    exit 0
  fi

  echo ""
done

echo "=== End (max iterations reached) ==="
