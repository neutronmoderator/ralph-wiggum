#!/usr/bin/env bash
# ralph-wiggum: "I'm helping!"
set -e

# Wipe progress.txt at start
> progress.txt

gum style --border double --padding "1 2" --border-foreground 212 "ralph-wiggum" "I'm helping!"

MAX_ITERATIONS=1

for ((i=1; i<=MAX_ITERATIONS; i++)); do
  gum spin --spinner dot --title "Iteration $i of $MAX_ITERATIONS" -- sleep 0.5
  gum style --foreground 212 "=== Iteration $i of $MAX_ITERATIONS ==="

  result=$(claude --dangerously-skip-permissions -p "$(cat prompt.md)" 2>&1 | tee /dev/stderr)

  if [[ "$result" == *"<promise>COMPLETE</promise>"* ]]; then
    echo ""
    gum style --foreground 46 --bold "PRD complete!"
    exit 0
  fi

  echo ""
done

gum style --foreground 208 "End (max iterations reached)"
